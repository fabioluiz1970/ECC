<html><head></head><body style="overflow-wrap: break-word; -webkit-nbsp-mode: space; line-break: after-white-space;">ECC atual&nbsp;<br><div><br></div><div><div>&lt;!DOCTYPE html&gt;</div><div>&lt;html lang="pt-BR"&gt;</div><div>&lt;head&gt;</div><div>&lt;meta charset="UTF-8" /&gt;</div><div>&lt;meta name="viewport" content="width=device-width,initial-scale=1.0"/&gt;</div><div>&lt;title&gt;Gerenciador de Cronograma de Evento — Offline v32.0&lt;/title&gt;</div><div>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</div><div>&lt;style&gt;</div><div>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap');</div><div>:root {</div><div>&nbsp; --primary-color: #4f46e5; --primary-hover: #4338ca; --secondary-color: #10b981;</div><div>&nbsp; --danger-color: #ef4444; --danger-hover: #dc2626; --background-color: #f3f4f6;</div><div>&nbsp; --card-background: #ffffff; --text-primary: #1f2937; --text-secondary: #6b7280;</div><div>}</div><div>body { font-family: 'Inter', sans-serif; background-color: var(--background-color); color: var(--text-primary); }</div><div>.tab-button { padding: .75rem 1.5rem; font-weight: 600; border-radius: .5rem .5rem 0 0; cursor: pointer; transition: all .3s ease; white-space: nowrap; border-bottom: 3px solid transparent; }</div><div>.tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); background-color: var(--card-background); }</div><div>.tab-content { display: none; padding: 1.5rem; background: var(--card-background); border-radius: 0 .5rem .5rem .5rem; opacity: 0; transition: opacity .3s ease-in-out; }</div><div>.tab-content.active { display: block; opacity: 1; }</div><div>.time-input,.planned-time-input { border: 1px solid #d1d5db; border-radius: .375rem; text-align: center; font-weight: 600; transition: border-color .2s, box-shadow .2s; }</div><div>.time-input:focus,.planned-time-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(79,70,229,.3); }</div><div>.time-input { padding: .5rem; font-size: 1rem; }</div><div>.planned-time-input { padding: .25rem; font-size: .75rem; width: 55px; }</div><div>.btn { padding: .5rem 1rem; border-radius: .375rem; font-weight: 600; transition: all .2s ease; display: inline-flex; align-items: center; justify-content: center; gap: .5rem; border: none; cursor: pointer; }</div><div>.btn-primary { background: var(--primary-color); color: #fff; }</div><div>.btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); box-shadow: 4px 4px 10px rgba(0,0,0,.1); }</div><div>.btn-danger { background: var(--danger-color); color: #fff; }</div><div>.btn-danger:hover { background: var(--danger-hover); }</div><div>.btn-success { background: var(--secondary-color); color: #fff; }</div><div>.btn-success:hover { background: #059669; }</div><div>.btn-icon { padding: .5rem; }</div><div>.status-card-in-progress { border-left: 4px solid #3b82f6; }</div><div>.status-card-on-time { border-left: 4px solid #22c55e; }</div><div>.status-card-late { border-left: 4px solid #f59e0b; }</div><div>.status-card-very-late { border-left: 4px solid var(--danger-color); }</div><div>.status-card-upcoming { border-left: 4px solid #9ca3af; }</div><div>.spinner { border: 4px solid rgba(255,255,255,.3); border-top: 4px solid #fff; border-radius: 50%; width: 1.25rem; height: 1.25rem; animation: spin 1s linear infinite; }</div><div>@keyframes spin { to { transform: rotate(360deg); } }</div><div>@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }</div><div>@keyframes slideIn { from { transform: translateY(-20px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }</div><div>.modal { display: none; position: fixed; z-index: 50; left:0; top:0; width:100%; height:100%; overflow:auto; background: rgba(0,0,0,.5); justify-content:center; align-items:center; animation: fadeIn .3s ease-out; }</div><div>.modal-content { background: var(--card-background); padding: 2rem; border-radius: .75rem; box-shadow: 0 10px 25px rgba(0,0,0,.1); width: 90%; max-width: 500px; text-align: center; animation: slideIn .3s ease-out; }</div><div>.table-container { max-height: 60vh; overflow-y: auto; border-radius: .5rem; }</div><div>.loading-overlay { display: flex; justify-content: center; align-items: center; background-color: rgba(255,255,255,0.8); position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 40; }</div><div>.table-sticky-header { position: sticky; top: 0; background-color: white; z-index: 10; }</div><div>.table-cell-day { min-width: 10rem; }</div><div>.table-cell-fixed { min-width: 14rem; }</div><div>.table-cell-time { min-width: 6rem; }</div><div>.toast {</div><div>&nbsp; position: fixed; top: 12px; left: 50%; transform: translateX(-50%);</div><div>&nbsp; background: #111827; color: #fff; padding: 10px 16px; border-radius: 8px; z-index: 60; display:none;</div><div>}</div><div>.btn .spinner { border-top-color: #fff; }</div><div>&lt;/style&gt;</div><div>&lt;/head&gt;</div><div>&lt;body class="p-2 sm:p-4"&gt;</div><div>&lt;!-- Overlay de Carregamento --&gt;</div><div>&lt;div id="loading-overlay" class="loading-overlay hidden"&gt;</div><div>&nbsp; &lt;div class="spinner"&gt;&lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;!-- Toast --&gt;</div><div>&lt;div id="toast" class="toast"&gt;&lt;/div&gt;</div><div><br></div><div>&lt;!-- Header --&gt;</div><div>&lt;div&gt;</div><div>&nbsp; &lt;header class="flex flex-col sm:flex-row justify-between items-center mb-6 p-4 bg-gradient-to-r from-gray-800 to-gray-700 text-white rounded-xl shadow-lg"&gt;</div><div>&nbsp; &nbsp; &lt;h1 class="text-2xl sm:text-3xl font-bold mb-2 sm:mb-0"&gt;ECC 45&lt;/h1&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex flex-col items-center sm:items-end space-y-2 relative w-full sm:w-auto"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div id="relogio" class="text-xl sm:text-2xl font-bold"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div id="status-container" class="text-center sm:text-right"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="status-geral" class="text-lg font-semibold"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="fim-previsto" class="text-sm font-light text-gray-300"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="last-updated" class="text-xs text-gray-400 mt-1"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="flex gap-2 mt-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-success" onclick="window.exportAllData()"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exportar</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;label class="btn btn-primary cursor-pointer"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input id="import-file" type="file" accept="application/json" class="hidden" onchange="window.showImportConfirmation()"/&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Importar</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/label&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/header&gt;</div><div><br></div><div>&nbsp; &lt;!-- Tabs --&gt;</div><div>&nbsp; &lt;div class="flex border-b border-gray-200 overflow-x-auto bg-white" id="main-tabs"&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button active" onclick="window.openTab(event, 'programacaoCompleta')"&gt;Programação Completa&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button" onclick="window.openTab(event, 'sabado')"&gt;Sábado&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button" onclick="window.openTab(event, 'domingo')"&gt;Domingo&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button" onclick="window.openTab(event, 'resumoSabado')"&gt;Resumo Sábado&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button" onclick="window.openTab(event, 'resumoDomingo')"&gt;Resumo Domingo&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button" onclick="window.openTab(event, 'gerenciarDados')"&gt;Gerenciar Dados&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;button class="tab-button" onclick="window.openTab(event, 'gerenciarAlertas')"&gt;Gerenciar Alertas&lt;/button&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;!-- Conteúdos das abas --&gt;</div><div>&lt;div class="relative"&gt;</div><div>&nbsp; &lt;div id="programacaoCompleta" class="tab-content active"&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex flex-col sm:flex-row flex-wrap justify-between items-center gap-4 mb-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h1 class="text-2xl font-bold"&gt;Programação Completa&lt;/h1&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="flex-grow flex items-center gap-4 w-full sm:w-auto mt-2 sm:mt-0"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" id="searchInput" placeholder="Buscar por atividade ou local..." class="flex-1 p-2 rounded-md border border-gray-300" oninput="window.filterAndRender()"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;select id="dayFilter" class="p-2 rounded-md border border-gray-300" onchange="window.filterAndRender()"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="all"&gt;Todos os Dias&lt;/option&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="sabado"&gt;Sábado&lt;/option&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="domingo"&gt;Domingo&lt;/option&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="flex gap-2 mt-4 sm:mt-0"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.exportDayToCsv('sabado')" class="btn btn-success"&gt;Exportar Sábado (CSV)&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.exportDayToCsv('domingo')" class="btn btn-success"&gt;Exportar Domingo (CSV)&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary" onclick="window.showAddModal(null, document.getElementById('dayFilter')?.value === 'all' ? 'sabado' : document.getElementById('dayFilter')?.value)"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"&gt;&lt;/path&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Adicionar</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="table-container"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div id="programacao-completa-container"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div><br></div><div>&nbsp; &lt;div id="sabado" class="tab-content"&gt;&lt;div id="sabado-container" class="space-y-6"&gt;&lt;/div&gt;&lt;/div&gt;</div><div>&nbsp; &lt;div id="domingo" class="tab-content"&gt;&lt;div id="domingo-container" class="space-y-6"&gt;&lt;/div&gt;&lt;/div&gt;</div><div><br></div><div>&nbsp; &lt;div id="resumoSabado" class="tab-content"&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex flex-wrap justify-between items-center gap-4 mb-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h1 class="text-2xl font-bold"&gt;Resumo de Sábado&lt;/h1&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="flex gap-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.exportDayToCsv('sabado')" class="btn btn-success"&gt;Exportar Cronograma (CSV)&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.exportSummaryToHtml('sabado')" class="btn btn-primary"&gt;Resumo (HTML)&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="analyzeSabadoBtn" onclick="window.analyzeDayWithAI('sabado')" class="btn bg-indigo-600 hover:bg-indigo-700"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"&gt;&lt;/path&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="btn-text"&gt;Análise com IA&lt;/span&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="spinner hidden"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div id="resumo-sabado-container"&gt;&lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div><br></div><div>&nbsp; &lt;div id="resumoDomingo" class="tab-content"&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex flex-wrap justify-between items-center gap-4 mb-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h1 class="text-2xl font-bold"&gt;Resumo de Domingo&lt;/h1&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="flex gap-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.exportDayToCsv('domingo')" class="btn btn-success"&gt;Exportar Cronograma (CSV)&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.exportSummaryToHtml('domingo')" class="btn btn-primary"&gt;Resumo (HTML)&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="analyzeDomingoBtn" onclick="window.analyzeDayWithAI('domingo')" class="btn bg-indigo-600 hover:bg-indigo-700"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"&gt;&lt;/path&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="btn-text"&gt;Análise com IA&lt;/span&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="spinner hidden"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div id="resumo-domingo-container"&gt;&lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div><br></div><div>&nbsp; &lt;div id="gerenciarDados" class="tab-content"&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-2 pt-6"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h2 class="text-2xl font-bold mb-4"&gt;Gerenciamento de Dados&lt;/h2&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="p-4 rounded-lg bg-gray-100 shadow-inner mb-6"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 class="font-bold text-lg mb-2"&gt;Gerenciar Atividades&lt;/h3&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;p class="text-sm text-gray-600 mb-2"&gt;Adicione ou remova atividades da lista de seleção principal.&lt;/p&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="activities-list" class="flex flex-wrap gap-2"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="mt-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" id="new-activity-input" placeholder="Nome da atividade..." class="flex-1 p-2 rounded-md border border-gray-300"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.addActivity()" class="btn btn-primary ml-2"&gt;Adicionar&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="p-4 rounded-lg bg-gray-100 shadow-inner mb-6"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 class="font-bold text-lg mb-2"&gt;Gerenciar Locais&lt;/h3&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;p class="text-sm text-gray-600 mb-2"&gt;Adicione ou remova locais da lista de seleção principal.&lt;/p&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="locations-list" class="flex flex-wrap gap-2"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="mt-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" id="new-location-input" placeholder="Nome do local..." class="flex-1 p-2 rounded-md border border-gray-300"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick="window.addLocation()" class="btn btn-primary ml-2"&gt;Adicionar&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div><br></div><div>&nbsp; &lt;div id="gerenciarAlertas" class="tab-content"&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex flex-col sm:flex-row flex-wrap justify-between items-center gap-4 mb-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h1 class="text-2xl font-bold"&gt;Gerenciar Alertas&lt;/h1&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;input type="text" id="alertSearchInput" placeholder="Buscar por atividade ou mensagem..." class="flex-1 p-2 rounded-md border border-gray-300" oninput="window.renderAlertsManager()"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary" onclick="window.addGlobalAlert()"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"&gt;&lt;/path&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Incluir Linha de Alerta</div><div>&nbsp; &nbsp; &nbsp; &lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="table-container"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div id="alert-manager-container"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-8 bg-white p-4 rounded-lg shadow-md"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h3 class="font-bold text-lg mb-4"&gt;Histórico de Alertas Disparados&lt;/h3&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="overflow-x-auto rounded-lg shadow-inner max-h-60"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;table class="min-w-full bg-white border-collapse"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;thead class="bg-gray-200 table-sticky-header"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tr class="text-left font-medium"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 border-b border-gray-300"&gt;Disparo&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 border-b border-gray-300"&gt;Atividade&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 border-b border-gray-300"&gt;Agendado Para&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 border-b border-gray-300"&gt;Mensagem&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/thead&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tbody id="alertHistoryTableBody" class="divide-y divide-gray-200"&gt;&lt;/tbody&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/table&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div><br></div><div>&lt;/div&gt;</div><div><br></div><div>&lt;!-- Modals --&gt;</div><div>&lt;div id="deleteModal" class="modal"&gt;</div><div>&nbsp; &lt;div class="modal-content"&gt;</div><div>&nbsp; &nbsp; &lt;h2 class="text-xl font-bold mb-4"&gt;Confirmar Exclusão&lt;/h2&gt;</div><div>&nbsp; &nbsp; &lt;p&gt;Tem certeza de que deseja remover esta atividade?&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-6 flex justify-center gap-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="confirmDelete" class="btn btn-danger"&gt;Remover&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="cancelDelete" class="btn bg-gray-200 hover:bg-gray-300"&gt;Cancelar&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;div id="addModal" class="modal"&gt;</div><div>&nbsp; &lt;div class="modal-content"&gt;</div><div>&nbsp; &nbsp; &lt;h2 class="text-xl font-bold mb-4"&gt;Adicionar Nova Linha&lt;/h2&gt;</div><div>&nbsp; &nbsp; &lt;p&gt;Onde você deseja adicionar a nova linha?&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-6 flex justify-center gap-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="addAbove" class="btn btn-primary"&gt;Acima&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="addBelow" class="btn btn-primary"&gt;Abaixo&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="cancelAdd" class="btn bg-gray-200 hover:bg-gray-300"&gt;Cancelar&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;div id="notificationModal" class="modal"&gt;</div><div>&nbsp; &lt;div class="modal-content"&gt;</div><div>&nbsp; &nbsp; &lt;h2 id="notificationTitle" class="text-xl font-bold mb-4"&gt;Aviso&lt;/h2&gt;</div><div>&nbsp; &nbsp; &lt;p id="notificationMessage"&gt;Mensagem aqui.&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-6 flex justify-center"&gt;&lt;button id="notificationClose" class="btn btn-primary"&gt;OK&lt;/button&gt;&lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;div id="importConfirmationModal" class="modal"&gt;</div><div>&nbsp; &lt;div class="modal-content"&gt;</div><div>&nbsp; &nbsp; &lt;h2 class="text-xl font-bold mb-4"&gt;Confirmar Importação&lt;/h2&gt;</div><div>&nbsp; &nbsp; &lt;p&gt;A importação substituirá todos os dados atuais. Deseja continuar?&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-6 flex justify-center gap-4"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="confirmImport" class="btn btn-danger"&gt;Sim, importar&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="cancelImport" class="btn bg-gray-200 hover:bg-gray-300"&gt;Cancelar&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;div id="alertModal" class="modal"&gt;</div><div>&nbsp; &lt;div class="modal-content"&gt;</div><div>&nbsp; &nbsp; &lt;h2 id="alertTitle" class="text-2xl font-bold mb-4 text-blue-600"&gt;Alerta de Atividade&lt;/h2&gt;</div><div>&nbsp; &nbsp; &lt;p id="alertMessage" class="text-lg"&gt;Mensagem do alerta aqui.&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-6 flex justify-center"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="alertClose" class="btn btn-primary"&gt;OK&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div>&lt;div id="aiAnalysisModal" class="modal"&gt;</div><div>&nbsp; &lt;div class="modal-content"&gt;</div><div>&nbsp; &nbsp; &lt;h2 class="text-2xl font-bold mb-4"&gt;Análise da IA&lt;/h2&gt;</div><div>&nbsp; &nbsp; &lt;div id="aiAnalysisResult" class="text-left whitespace-pre-wrap max-h-[60vh] overflow-y-auto p-4 bg-gray-50 rounded-lg border"&gt;&lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="mt-6 flex justify-center"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button id="aiAnalysisClose" class="btn btn-primary"&gt;Fechar&lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;</div><div><br></div><div><br></div><div>&lt;script&gt;</div><div>/* ===================== ESTADO E PERSISTÊNCIA LOCAL ===================== */</div><div>const STORAGE_KEY = 'cronograma_ecc_offline_v9'; // Version bump for new data structure</div><div>const LAST_EXPORT_KEY = 'cronograma_ecc_last_export';</div><div><br></div><div>/* ===== FUNÇÕES DE UTILIDADE E VALIDAÇÃO ===== */</div><div>function toMinutes(hhmm) {</div><div>&nbsp; if (typeof hhmm !== 'string') return null;</div><div>&nbsp; const m = hhmm.match(/^(\d{1,2}):(\d{2})$/);</div><div>&nbsp; if (!m) return null;</div><div>&nbsp; let h = Number(m[1]), mi = Number(m[2]);</div><div>&nbsp; if (!Number.isFinite(h) || !Number.isFinite(mi)) return null;</div><div>&nbsp; if (h &lt; 0 || h &gt; 23 || mi &lt; 0 || mi &gt; 59) return null;</div><div>&nbsp; return h * 60 + mi;</div><div>}</div><div>function sanitizeHHMM(s) {</div><div>&nbsp; if (!s || typeof s !== 'string') return '';</div><div>&nbsp; const mins = toMinutes(s);</div><div>&nbsp; if (mins === null) return '';</div><div>&nbsp; const h = String(Math.floor(mins/60)).padStart(2,'0');</div><div>&nbsp; const m = String(mins%60).padStart(2,'0');</div><div>&nbsp; return `${h}:${m}`;</div><div>}</div><div>function ensureActivityShape(it) {</div><div>&nbsp; return {</div><div>&nbsp; &nbsp; id: (typeof it.id === 'string' &amp;&amp; it.id) ? it.id : (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())),</div><div>&nbsp; &nbsp; day: (it.day === 'sabado' || it.day === 'domingo') ? it.day : 'sabado',</div><div>&nbsp; &nbsp; atividade: it.atividade ?? '',</div><div>&nbsp; &nbsp; local: it.local ?? '',</div><div>&nbsp; &nbsp; inicioPrevisto: sanitizeHHMM(it.inicioPrevisto || ''),</div><div>&nbsp; &nbsp; fimPrevisto: sanitizeHHMM(it.fimPrevisto || ''),</div><div>&nbsp; &nbsp; inicioReal: sanitizeHHMM(it.inicioReal || ''),</div><div>&nbsp; &nbsp; fimReal: sanitizeHHMM(it.fimReal || ''),</div><div>&nbsp; &nbsp; observacoes: it.observacoes ?? ''</div><div>&nbsp; };</div><div>}</div><div>function ensureGlobalAlertShape(it) {</div><div>&nbsp; &nbsp; return {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; id: it.id || crypto.randomUUID(),</div><div>&nbsp; &nbsp; &nbsp; &nbsp; day: (it.day === 'sabado' || it.day === 'domingo') ? it.day : 'sabado',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; event: it.event ?? '',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; plannedStartTime: sanitizeHHMM(it.plannedStartTime || ''),</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alertTime: sanitizeHHMM(it.alertTime || ''),</div><div>&nbsp; &nbsp; &nbsp; &nbsp; message: it.message ?? '',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; firedTime: sanitizeHHMM(it.firedTime || '') || null</div><div>&nbsp; &nbsp; };</div><div>}</div><div>function migrateState(raw) {</div><div>&nbsp; &nbsp; const migrated = {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; allActivities: Array.isArray(raw?.allActivities) ? raw.allActivities.map(ensureActivityShape) : [],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; activities: Array.isArray(raw?.activities) ? raw.activities.slice() : [],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; locations: Array.isArray(raw?.locations) ? raw.locations.slice() : [],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alertHistory: Array.isArray(raw?.alertHistory) ? raw.alertHistory.slice() : [],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; globalAlerts: Array.isArray(raw?.globalAlerts) ? raw.globalAlerts.map(ensureGlobalAlertShape) : []</div><div>&nbsp; &nbsp; };</div><div><br></div><div>&nbsp; &nbsp; const addFrom = (arr, val) =&gt; { if (val &amp;&amp; !arr.includes(val)) arr.push(val); };</div><div>&nbsp; &nbsp; migrated.allActivities.forEach(a =&gt; {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; addFrom(migrated.activities, a.atividade);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; addFrom(migrated.locations, a.local);</div><div>&nbsp; &nbsp; });</div><div>&nbsp; &nbsp; const sortCase = arr =&gt; arr.sort((x, y) =&gt; x.localeCompare(y, 'pt-BR', { sensitivity: 'base' }));</div><div>&nbsp; &nbsp; sortCase(migrated.activities);</div><div>&nbsp; &nbsp; sortCase(migrated.locations);</div><div>&nbsp; &nbsp; return migrated;</div><div>}</div><div><br></div><div>const DEFAULT_STATE = {</div><div>&nbsp; allActivities: [</div><div>&nbsp; &nbsp; { id: '1', day: 'sabado', atividade: "RECEPÇÃO IPVM", local: "IPVM", inicioPrevisto: "06:00", fimPrevisto: "07:00", inicioReal: "06:05", fimReal: "07:02", observacoes: "" },</div><div>&nbsp; &nbsp; { id: '2', day: 'sabado', atividade: "PREPARAÇÃO DA SALA", local: "Sala Principal", inicioPrevisto: "07:00", fimPrevisto: "07:30", inicioReal: "07:02", fimReal: "07:35", observacoes: "" },</div><div>&nbsp; &nbsp; { id: '4', day: 'sabado', atividade: "PALESTRA 1 - AMOR", local: "Sala Principal", inicioPrevisto: "15:00", fimPrevisto: "16:00", inicioReal: "15:08", fimReal: "", observacoes: "Palestrante: João" },</div><div>&nbsp; &nbsp; { id: '3', day: 'domingo', atividade: "CAFÉ HAVAIANO", local: "REFEITÓRIO", inicioPrevisto: "06:00", fimPrevisto: "07:00", inicioReal: "", fimReal: "", observacoes: "" }</div><div>&nbsp; ],</div><div>&nbsp; activities: ["RECEPÇÃO IPVM", "PREPARAÇÃO DA SALA", "CAFÉ HAVAIANO", "MONTAGEM", "PALESTRA 1 - AMOR"],</div><div>&nbsp; locations: ["IPVM", "Sala Principal", "REFEITÓRIO"],</div><div>&nbsp; alertHistory: [],</div><div>&nbsp; globalAlerts: []</div><div>};</div><div><br></div><div>let state = loadState() || DEFAULT_STATE;</div><div>let isInputFocused = false;</div><div><br></div><div>function saveState() {</div><div>&nbsp; try {</div><div>&nbsp; &nbsp; localStorage.setItem(STORAGE_KEY, JSON.stringify(state));</div><div>&nbsp; &nbsp; updateLastUpdatedTime();</div><div>&nbsp; } catch (e) { console.warn('Falha ao salvar no localStorage:', e); }</div><div>}</div><div>function loadState() {</div><div>&nbsp; try {</div><div>&nbsp; &nbsp; const raw = localStorage.getItem(STORAGE_KEY);</div><div>&nbsp; &nbsp; const parsed = raw ? JSON.parse(raw) : null;</div><div>&nbsp; &nbsp; return parsed ? migrateState(parsed) : null;</div><div>&nbsp; } catch (e) {</div><div>&nbsp; &nbsp; console.warn('Falha ao ler do localStorage:', e);</div><div>&nbsp; &nbsp; return null;</div><div>&nbsp; }</div><div>}</div><div>function updateLastUpdatedTime() {</div><div>&nbsp; const now = new Date();</div><div>&nbsp; const options = { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };</div><div>&nbsp; const formattedDate = now.toLocaleDateString('pt-BR', options);</div><div>&nbsp; document.getElementById('last-updated').textContent = `Última atualização: ${formattedDate}`;</div><div>}</div><div>function showToast(msg) {</div><div>&nbsp; const el = document.getElementById('toast');</div><div>&nbsp; el.textContent = msg;</div><div>&nbsp; el.style.display = 'block';</div><div>&nbsp; setTimeout(() =&gt; { el.style.display = 'none'; }, 3500);</div><div>}</div><div><br></div><div>function updateClock() {</div><div>&nbsp; const now = new Date();</div><div>&nbsp; const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };</div><div>&nbsp; const formattedTime = now.toLocaleTimeString('pt-BR', options);</div><div>&nbsp; const clockEl = document.getElementById('relogio');</div><div>&nbsp; if(clockEl) clockEl.textContent = formattedTime;</div><div>}</div><div><br></div><div><br></div><div>/* ===================== UI HELPERS ===================== */</div><div>const showNotification = (title, message) =&gt; {</div><div>&nbsp; document.getElementById('notificationTitle').textContent = title;</div><div>&nbsp; document.getElementById('notificationMessage').textContent = message;</div><div>&nbsp; document.getElementById('notificationModal').style.display = 'flex';</div><div>};</div><div>document.getElementById('notificationClose').onclick = () =&gt; {</div><div>&nbsp; document.getElementById('notificationModal').style.display = 'none';</div><div>};</div><div><br></div><div>const showAlertModal = (title, message) =&gt; {</div><div>&nbsp; document.getElementById('alertTitle').textContent = title;</div><div>&nbsp; document.getElementById('alertMessage').textContent = message;</div><div>&nbsp; document.getElementById('alertModal').style.display = 'flex';</div><div>};</div><div>document.getElementById('alertClose').onclick = () =&gt; {</div><div>&nbsp; document.getElementById('alertModal').style.display = 'none';</div><div>};</div><div>document.getElementById('aiAnalysisClose').onclick = () =&gt; {</div><div>&nbsp; document.getElementById('aiAnalysisModal').style.display = 'none';</div><div>};</div><div><br></div><div>const formatTime = (hhmm) =&gt; {</div><div>&nbsp; const mins = toMinutes(hhmm);</div><div>&nbsp; if (mins === null) return null;</div><div>&nbsp; const d = new Date();</div><div>&nbsp; d.setHours(Math.floor(mins/60), mins%60, 0, 0);</div><div>&nbsp; return d;</div><div>};</div><div>const getFormattedDeviation = (min) =&gt; {</div><div>&nbsp; if (min === null || isNaN(min)) return { text: '—', colorClass: 'text-gray-700' };</div><div>&nbsp; const a = Math.round(min);</div><div>&nbsp; if (Math.abs(a) &lt; 1) return { text: 'No Prazo', colorClass: 'text-gray-700' };</div><div>&nbsp; const signText = a &lt; 0 ? 'Adiantado' : 'Atrasado';</div><div>&nbsp; const colorClass = a &lt; 0 ? 'text-blue-500' : 'text-red-500';</div><div>&nbsp; if (Math.abs(a) &lt; 60) return { text: `${signText} (${Math.abs(a)} min)`, colorClass };</div><div>&nbsp; const h = Math.floor(Math.abs(a) / 60), m = Math.abs(a) % 60;</div><div>&nbsp; return { text: `${signText} (${h}h ${m}min)`, colorClass };</div><div>};</div><div>const formatRealDuration = (min) =&gt; {</div><div>&nbsp; const a = Math.abs(Math.round(min));</div><div>&nbsp; if (isNaN(a)) return '—';</div><div>&nbsp; if (a &lt; 60) return `${a} min`;</div><div>&nbsp; const h = Math.floor(a / 60), m = a % 60;</div><div>&nbsp; return `${h}h ${m}min`;</div><div>};</div><div>const escapeHtml = (s) =&gt; (s ?? '').toString().replace(/&amp;/g, "&amp;amp;").replace(/&lt;/g, "&amp;lt;").replace(/&gt;/g, "&amp;gt;").replace(/"/g, "&amp;quot;");</div><div>const downloadText = (filename, text, mime = "text/plain;charset=utf-8") =&gt; {</div><div>&nbsp; const blob = new Blob([text], { type: mime });</div><div>&nbsp; const link = document.createElement('a');</div><div>&nbsp; const url = URL.createObjectURL(blob);</div><div>&nbsp; link.href = url; link.download = filename;</div><div>&nbsp; document.body.appendChild(link); link.click();</div><div>&nbsp; document.body.removeChild(link); URL.revokeObjectURL(url);</div><div>};</div><div><br></div><div>/* ====== Alert sound (beep) ====== */</div><div>function playBeep() {</div><div>&nbsp; try {</div><div>&nbsp; &nbsp; const ctx = new (window.AudioContext || window.webkitAudioContext)();</div><div>&nbsp; &nbsp; const o = ctx.createOscillator();</div><div>&nbsp; &nbsp; const g = ctx.createGain();</div><div>&nbsp; &nbsp; o.type = 'sine';</div><div>&nbsp; &nbsp; o.frequency.value = 880;</div><div>&nbsp; &nbsp; g.gain.setValueAtTime(0.0001, ctx.currentTime);</div><div>&nbsp; &nbsp; g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.01);</div><div>&nbsp; &nbsp; g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.2);</div><div>&nbsp; &nbsp; o.connect(g); g.connect(ctx.destination);</div><div>&nbsp; &nbsp; o.start(); o.stop(ctx.currentTime + 0.21);</div><div>&nbsp; } catch(e) { /* Autoplay blocked? It's fine. */ }</div><div>}</div><div><br></div><div>/* ===================== CORE CONTROLS ===================== */</div><div>let activeDay = 'programacaoCompleta';</div><div>let itemToDelete = { id: null };</div><div>let itemToAdd = { day: null, prevId: null };</div><div><br></div><div>/* ====== INTELLIGENT ALERTS (LOCAL) ====== */</div><div>function logAlertEvent(alertId, type) {</div><div>&nbsp; &nbsp; const alert = (state.globalAlerts || []).find(a =&gt; a.id === alertId);</div><div>&nbsp; &nbsp; if (!alert) return;</div><div><br></div><div>&nbsp; &nbsp; const logEntry = {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; timestamp: new Date().toISOString(),</div><div>&nbsp; &nbsp; &nbsp; &nbsp; day: alert.day,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; activity: alert.event,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alertTime: alert.alertTime,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; message: alert.message,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; type</div><div>&nbsp; &nbsp; };</div><div>&nbsp; &nbsp; state.alertHistory.push(logEntry);</div><div>&nbsp; &nbsp; saveState();</div><div>}</div><div>function checkAndFireAlerts() {</div><div>&nbsp; &nbsp; const now = new Date();</div><div>&nbsp; &nbsp; const current = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;</div><div>&nbsp; &nbsp; let hasUpdates = false;</div><div><br></div><div>&nbsp; &nbsp; (state.globalAlerts || []).forEach(alert =&gt; {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const schM = toMinutes(alert.alertTime || '');</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const curM = toMinutes(current);</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; if (alert.alertTime &amp;&amp; !alert.firedTime &amp;&amp; schM !== null &amp;&amp; curM !== null &amp;&amp; schM &lt;= curM) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hasUpdates = true;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert.firedTime = current;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ('vibrate' in navigator) navigator.vibrate([200, 100, 200]);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; playBeep();</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const alertTitle = `Alerta: ${alert.event}`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const alertMessage = alert.message || `A atividade "${alert.event}" está programada para começar.`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; showAlertModal(alertTitle, alertMessage);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logAlertEvent(alert.id, 'fired');</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; });</div><div><br></div><div>&nbsp; &nbsp; if (hasUpdates) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; &nbsp; &nbsp; if (!isInputFocused) renderAllTabs();</div><div>&nbsp; &nbsp; }</div><div>}</div><div>function checkExportReminder() {</div><div>&nbsp; const lastExport = localStorage.getItem(LAST_EXPORT_KEY);</div><div>&nbsp; if (!lastExport) { showNotification("Lembrete de Exportação", "Atenção: você ainda não exportou um backup. Exporte seus dados para evitar perdas!"); return; }</div><div>&nbsp; const now = new Date();</div><div>&nbsp; const lastExportDate = new Date(lastExport);</div><div>&nbsp; const diffMinutes = (now - lastExportDate) / (1000 * 60);</div><div>&nbsp; if (diffMinutes &gt;= 15) {</div><div>&nbsp; &nbsp; const message = `Atenção! A última exportação foi há ${Math.round(diffMinutes)} minutos. Exporte seus dados para evitar perdas!`;</div><div>&nbsp; &nbsp; showNotification("Lembrete de Exportação", message);</div><div>&nbsp; }</div><div>}</div><div><br></div><div>/* ======= Automatic REAL time fill ======= */</div><div>function autoFillNextRealStart(currentId) {</div><div>&nbsp; const currentItem = state.allActivities.find(item =&gt; item.id === currentId);</div><div>&nbsp; if (!currentItem || !currentItem.fimReal) return;</div><div>&nbsp;&nbsp;</div><div>&nbsp; const sortedActivities = [...state.allActivities]</div><div>&nbsp; &nbsp; .filter(item =&gt; item.day === currentItem.day)</div><div>&nbsp; &nbsp; .sort((a,b) =&gt; (toMinutes(a.inicioPrevisto) || Number.POSITIVE_INFINITY) - (toMinutes(b.inicioPrevisto) || Number.POSITIVE_INFINITY));</div><div><br></div><div>&nbsp; const currentIndex = sortedActivities.findIndex(item =&gt; item.id === currentId);</div><div>&nbsp;&nbsp;</div><div>&nbsp; if (currentIndex === -1 || currentIndex + 1 &gt;= sortedActivities.length) return;</div><div>&nbsp;&nbsp;</div><div>&nbsp; const nextActivity = sortedActivities[currentIndex + 1];</div><div>&nbsp; const nextActivityIndex = state.allActivities.findIndex(item =&gt; item.id === nextActivity.id);</div><div>&nbsp;&nbsp;</div><div>&nbsp; if (nextActivityIndex !== -1) {</div><div>&nbsp; &nbsp; state.allActivities[nextActivityIndex].inicioReal = currentItem.fimReal;</div><div>&nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; renderAllTabs();</div><div>&nbsp; }</div><div>}</div><div><br></div><div>/* ======= CONSOLIDATED SAVE FUNCTION ======= */</div><div>window.saveChanges = (id, fields) =&gt; {</div><div>&nbsp; const itemIndex = state.allActivities.findIndex(item =&gt; item.id === id);</div><div>&nbsp; if (itemIndex === -1) return;</div><div><br></div><div>&nbsp; const updatedData = {};</div><div>&nbsp; for (const key in fields) {</div><div>&nbsp; &nbsp; if (fields.hasOwnProperty(key)) {</div><div>&nbsp; &nbsp; &nbsp; if (['inicioPrevisto', 'fimPrevisto', 'inicioReal', 'fimReal'].includes(key)) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; updatedData[key] = sanitizeHHMM(fields[key] || '');</div><div>&nbsp; &nbsp; &nbsp; } else if (key === 'observacoes') {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const v = fields[key] ?? '';</div><div>&nbsp; &nbsp; &nbsp; &nbsp; updatedData[key] = v.trim() === '—' ? '' : v;</div><div>&nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; updatedData[key] = fields[key];</div><div>&nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; }</div><div>&nbsp; }</div><div><br></div><div>&nbsp; Object.assign(state.allActivities[itemIndex], updatedData);</div><div>&nbsp; saveState();</div><div>&nbsp; if (updatedData.fimReal) autoFillNextRealStart(id);</div><div>&nbsp; renderAllTabs();</div><div>&nbsp; showToast('Alterações salvas com sucesso!');</div><div>};</div><div><br></div><div>window.updateRealTimeInput = (input, id, field) =&gt; {</div><div>&nbsp; const item = state.allActivities.find(item =&gt; item.id === id);</div><div>&nbsp; if (item) item[field] = input.value;</div><div>};</div><div><br></div><div>window.setRealTime = (id, field) =&gt; {</div><div>&nbsp; const now = new Date();</div><div>&nbsp; const t = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;</div><div>&nbsp; window.saveChanges(id, { [field]: t });</div><div>};</div><div>window.clearTime = (id, field) =&gt; {</div><div>&nbsp; window.saveChanges(id, { [field]: '' });</div><div>};</div><div><br></div><div>const calculateStatus = (item) =&gt; {</div><div>&nbsp; const now = new Date();</div><div>&nbsp; const iP = formatTime(item.inicioPrevisto);</div><div>&nbsp; const fP = formatTime(item.fimPrevisto);</div><div>&nbsp; const iR = formatTime(item.inicioReal);</div><div>&nbsp; const fR = formatTime(item.fimReal);</div><div><br></div><div>&nbsp; if (fR) {</div><div>&nbsp; &nbsp; const diff = (fP &amp;&amp; fR) ? (fR - fP) / 60000 : null;</div><div>&nbsp; &nbsp; let detailText = "Concluído";</div><div>&nbsp; &nbsp; let textColor = 'text-gray-600';</div><div>&nbsp; &nbsp; if (diff !== null) {</div><div>&nbsp; &nbsp; &nbsp; const formattedDiff = Math.abs(Math.round(diff));</div><div>&nbsp; &nbsp; &nbsp; if (diff &gt; 5) { detailText = `Atraso (${formattedDiff} min)`; textColor = 'text-red-500'; }</div><div>&nbsp; &nbsp; &nbsp; else if (diff &lt; -5) { detailText = `Adiantado (${formattedDiff} min)`; textColor = 'text-blue-500'; }</div><div>&nbsp; &nbsp; &nbsp; else { detailText = "No Prazo"; }</div><div>&nbsp; &nbsp; } else { detailText = "Sem tempo previsto"; }</div><div>&nbsp; &nbsp; return { text: "Concluído", detail: detailText, color: 'bg-green-600', textColor, cardClass: 'status-card-on-time' };</div><div>&nbsp; }</div><div>&nbsp; if (iR) {</div><div>&nbsp; &nbsp; const plannedEndTime = formatTime(item.fimPrevisto);</div><div>&nbsp; &nbsp; let detailText = "Em progresso"; let textColor = 'text-gray-600';</div><div>&nbsp; &nbsp; if (plannedEndTime) {</div><div>&nbsp; &nbsp; &nbsp; const diffFromPlannedEnd = (now - plannedEndTime) / 60000;</div><div>&nbsp; &nbsp; &nbsp; const formattedDiff = Math.abs(Math.round(diffFromPlannedEnd));</div><div>&nbsp; &nbsp; &nbsp; if (diffFromPlannedEnd &gt; 5) { detailText = `Atraso (${formattedDiff} min)`; textColor = 'text-red-500'; }</div><div>&nbsp; &nbsp; &nbsp; else if (diffFromPlannedEnd &lt; -5) { detailText = `Adiantado (${formattedDiff} min)`; textColor = 'text-blue-500'; }</div><div>&nbsp; &nbsp; &nbsp; else { detailText = "No Prazo"; }</div><div>&nbsp; &nbsp; }</div><div>&nbsp; &nbsp; return { text: "Em Andamento", detail: detailText, color: 'bg-blue-500', textColor, cardClass: 'status-card-in-progress' };</div><div>&nbsp; }</div><div>&nbsp; if (iP &amp;&amp; now &gt; iP) {</div><div>&nbsp; &nbsp; const diff = (now - iP) / 60000;</div><div>&nbsp; &nbsp; return {</div><div>&nbsp; &nbsp; &nbsp; text: "Atrasado",</div><div>&nbsp; &nbsp; &nbsp; detail: `(${Math.round(diff)} min)`,</div><div>&nbsp; &nbsp; &nbsp; color: diff &gt; 30 ? 'bg-red-500' : 'bg-yellow-500',</div><div>&nbsp; &nbsp; &nbsp; textColor: diff &gt; 30 ? 'text-white' : 'text-yellow-800',</div><div>&nbsp; &nbsp; &nbsp; cardClass: diff &gt; 30 ? 'status-card-very-late' : 'status-card-late'</div><div>&nbsp; &nbsp; };</div><div>&nbsp; }</div><div>&nbsp; return { text: "Próximo", detail: `Inicia às ${item.inicioPrevisto || '--:--'}`, color: 'bg-gray-400', textColor: 'text-white', cardClass: 'status-card-upcoming' };</div><div>};</div><div><br></div><div>const renderCronograma = (day) =&gt; {</div><div>&nbsp; const container = document.getElementById(`${day}-container`);</div><div>&nbsp; const data = state.allActivities.filter(item =&gt; item.day === day) || [];</div><div>&nbsp; if (!container) return;</div><div>&nbsp; const sortedData = [...data].sort((a,b) =&gt; (toMinutes(a.inicioPrevisto) || Number.POSITIVE_INFINITY) - (toMinutes(b.inicioPrevisto) || Number.POSITIVE_INFINITY));</div><div><br></div><div>&nbsp; let html = sortedData.map((item, index) =&gt; {</div><div>&nbsp; &nbsp; const status = calculateStatus(item);</div><div>&nbsp; &nbsp; const detailsId = `details-${day}-${index}`;</div><div>&nbsp; &nbsp; return `</div><div>&lt;div class="p-4 rounded-lg shadow-md border ${status.cardClass}" data-activity-id="${item.id}"&gt;</div><div>&nbsp; &lt;div class="flex flex-col sm:flex-row justify-between items-start sm:items-center"&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex items-center gap-4 flex-grow"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;input type="text" inputmode="numeric" maxlength="5" pattern="\\d{1,2}:\\d{2}" placeholder="HH:mm" class="planned-time-input text-lg font-bold text-indigo-600 js-planned-start" value="${item.inicioPrevisto}"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; onfocus="window.isInputFocused=true; this.select()"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; oninput="window.formatInputTime(this); window.updateRealTimeInput(this,'${item.id}','inicioPrevisto')"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; onblur="window.isInputFocused=false; window.saveChanges('${item.id}', {inicioPrevisto: this.value})"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;input type="text" title="Nome da Atividade" class="text-lg font-semibold w-full border-b-2 border-transparent focus:border-indigo-500 focus:outline-none js-activity-input" value="${escapeHtml(item.atividade)}" placeholder="Nome da Atividade" onblur="window.saveChanges('${item.id}', {atividade: this.value})"&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="flex items-center gap-2 mt-2 sm:mt-0"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;span class="px-3 py-1 text-sm font-bold rounded-full text-white ${status.color}"&gt;${status.text}&lt;/span&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary btn-icon" title="Mostrar/Ocultar Detalhes" onclick="document.getElementById('${detailsId}').classList.toggle('hidden')"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /&gt;&lt;/svg&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/button&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div><br></div><div>&nbsp; &lt;div id="${detailsId}" class="hidden mt-4 pt-4 border-t border-gray-200 space-y-4"&gt;</div><div>&nbsp; &nbsp; &lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;strong&gt;Local:&lt;/strong&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" class="w-full border-gray-300 rounded-md p-2 text-sm mt-1 js-local-input" placeholder="Local..." value="${escapeHtml(item.local || '')}" onblur="window.saveChanges('${item.id}', {local: this.value})"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;strong&gt;Fim Previsto:&lt;/strong&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type="text" inputmode="numeric" maxlength="5" pattern="\\d{1,2}:\\d{2}" placeholder="HH:mm" class="planned-time-input js-planned-end" value="${item.fimPrevisto}"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onfocus="window.isInputFocused=true; this.select()"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oninput="window.formatInputTime(this); window.updateRealTimeInput(this,'${item.id}','fimPrevisto')"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onblur="window.isInputFocused=false; window.saveChanges('${item.id}', {fimPrevisto: this.value})"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div class="flex items-center gap-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;strong&gt;Real:&lt;/strong&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="flex items-center gap-1 w-full"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" inputmode="numeric" placeholder="HH:mm" class="time-input w-full js-real-start" value="${item.inicioReal}"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onfocus="window.isInputFocused=true; this.select()"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oninput="window.formatInputTime(this); window.updateRealTimeInput(this,'${item.id}','inicioReal')"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onblur="window.isInputFocused=false; window.saveChanges('${item.id}', {inicioReal: this.value})"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="flex flex-col gap-1"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary btn-icon" title="Marcar início agora" onclick="window.setRealTime('${item.id}', 'inicioReal')"&gt;⏱&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-danger btn-icon" title="Limpar início" onclick="window.clearTime('${item.id}', 'inicioReal')"&gt;&amp;times;&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="font-bold text-xl"&gt;-&lt;/span&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="flex items-center gap-1 w-full"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" inputmode="numeric" placeholder="HH:mm" class="time-input w-full js-real-end" value="${item.fimReal}"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onfocus="window.isInputFocused=true; this.select()"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oninput="window.formatInputTime(this); window.updateRealTimeInput(this,'${item.id}','fimReal')"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onblur="window.isInputFocused=false; window.saveChanges('${item.id}', {fimReal: this.value})"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="flex flex-col gap-1"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary btn-icon" title="Marcar fim agora" onclick="window.setRealTime('${item.id}', 'fimReal')"&gt;⏱&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-danger btn-icon" title="Limpar fim" onclick="window.clearTime('${item.id}', 'fimReal')"&gt;&amp;times;&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div><br></div><div>&nbsp; &nbsp; &lt;div class="grid grid-cols-1 text-sm"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;div&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;strong&gt;Observações:&lt;/strong&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" class="w-full border-gray-300 rounded-md p-2 text-sm mt-1 js-obs-input" placeholder="Observações..." value="${escapeHtml(item.observacoes || '')}" onblur="window.saveChanges('${item.id}', {observacoes: this.value})"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;`;</div><div>&nbsp; }).join('');</div><div>&nbsp; container.innerHTML = html;</div><div>};</div><div><br></div><div>const updateHeaderStatus = () =&gt; {</div><div>&nbsp; const day = (['sabado', 'domingo'].includes(activeDay)) ? activeDay : 'sabado';</div><div>&nbsp; const allActivitiesSorted = [...state.allActivities]</div><div>&nbsp; &nbsp; &nbsp; .filter(item =&gt; item.day === day)</div><div>&nbsp; &nbsp; &nbsp; .sort((a, b) =&gt; (toMinutes(a.inicioPrevisto) || Number.POSITIVE_INFINITY) - (toMinutes(b.inicioPrevisto) || Number.POSITIVE_INFINITY));</div><div><br></div><div>&nbsp; const lastCompletedItem = [...allActivitiesSorted].reverse().find(item =&gt; item.fimReal);</div><div>&nbsp; const lastPlannedItem = allActivitiesSorted[allActivitiesSorted.length - 1];</div><div>&nbsp;&nbsp;</div><div>&nbsp; const elStatus = document.getElementById('status-geral');</div><div>&nbsp; const elFimPrevisto = document.getElementById('fim-previsto');</div><div><br></div><div>&nbsp; let currentInProgress = allActivitiesSorted.find(item =&gt; item.inicioReal &amp;&amp; !item.fimReal);</div><div>&nbsp; if (currentInProgress) {</div><div>&nbsp; &nbsp; &nbsp; const startDeviation = toMinutes(currentInProgress.inicioReal) - toMinutes(currentInProgress.inicioPrevisto);</div><div>&nbsp; &nbsp; &nbsp; const deviationStatus = getFormattedDeviation(startDeviation);</div><div>&nbsp; &nbsp; &nbsp; elStatus.textContent = `${currentInProgress.atividade}: ${deviationStatus.text}`;</div><div>&nbsp; &nbsp; &nbsp; elStatus.className = `text-lg font-semibold ${deviationStatus.colorClass || 'text-gray-700'}`;</div><div>&nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; const nextActivity = allActivitiesSorted.find(item =&gt; !item.inicioReal);</div><div>&nbsp; &nbsp; &nbsp; if (nextActivity) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elStatus.textContent = `Próxima: ${nextActivity.atividade}`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elStatus.className = 'text-lg font-semibold text-gray-300';</div><div>&nbsp; &nbsp; &nbsp; } else if (allActivitiesSorted.length &gt; 0) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elStatus.textContent = 'Todas as atividades concluídas.';</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elStatus.className = 'text-lg font-semibold text-green-400';</div><div>&nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elStatus.textContent = 'Nenhuma atividade para hoje.';</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elStatus.className = 'text-lg font-semibold text-gray-300';</div><div>&nbsp; &nbsp; &nbsp; }</div><div>&nbsp; }</div><div><br></div><div>&nbsp; if (lastCompletedItem &amp;&amp; lastPlannedItem) {</div><div>&nbsp; &nbsp; &nbsp; const remainingActivities = allActivitiesSorted.slice(allActivitiesSorted.findIndex(item =&gt; item.id === lastCompletedItem.id) + 1);</div><div>&nbsp; &nbsp; &nbsp; const remainingPlannedDuration = remainingActivities.reduce((total, item) =&gt; {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const planned = (toMinutes(item.fimPrevisto) || 0) - (toMinutes(item.inicioPrevisto) || 0);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return total + (planned &gt; 0 ? planned : 0);</div><div>&nbsp; &nbsp; &nbsp; }, 0);</div><div>&nbsp; &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; &nbsp; const lastRealMinutes = toMinutes(lastCompletedItem.fimReal);</div><div>&nbsp; &nbsp; &nbsp; const estimatedEndMinutes = lastRealMinutes + remainingPlannedDuration;</div><div>&nbsp; &nbsp; &nbsp; const totalEndTime = new Date();</div><div>&nbsp; &nbsp; &nbsp; totalEndTime.setHours(Math.floor(estimatedEndMinutes / 60), estimatedEndMinutes % 60, 0, 0);</div><div>&nbsp; &nbsp; &nbsp; elFimPrevisto.textContent = `Fim estimado: ${totalEndTime.getHours().toString().padStart(2, '0')}:${totalEndTime.getMinutes().toString().padStart(2, '0')}`;</div><div>&nbsp; } else if (lastPlannedItem) {</div><div>&nbsp; &nbsp; &nbsp; elFimPrevisto.textContent = `Fim previsto: ${lastPlannedItem.fimPrevisto || '--:--'}`;</div><div>&nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; elFimPrevisto.textContent = '';</div><div>&nbsp; }</div><div>};</div><div><br></div><div>window.openTab = (evt, tabName) =&gt; {</div><div>&nbsp; document.querySelectorAll('.tab-content').forEach(t =&gt; t.classList.remove('active'));</div><div>&nbsp; document.querySelectorAll('.tab-button').forEach(b =&gt; b.classList.remove('active'));</div><div>&nbsp; document.getElementById(tabName).classList.add('active');</div><div>&nbsp; evt.currentTarget.classList.add('active');</div><div>&nbsp; activeDay = tabName;</div><div>&nbsp; renderAllTabs();</div><div>};</div><div><br></div><div>const renderSummary = (day, data, containerEl) =&gt; {</div><div>&nbsp; const container = containerEl || document.getElementById(`resumo-${day}-container`);</div><div>&nbsp; if (!data || data.length === 0) { container.innerHTML = `&lt;p class="text-center text-gray-500"&gt;Nenhum dado disponível para este dia.&lt;/p&gt;`; return; }</div><div>&nbsp;&nbsp;</div><div>&nbsp; let totalPlannedDuration = 0;</div><div>&nbsp; let totalRealDuration = 0;</div><div>&nbsp; let totalDeviationMinutes = 0;</div><div>&nbsp; let lastCompletedOrStartedEvent = null;</div><div><br></div><div>&nbsp; const sortedData = [...data].sort((a,b) =&gt; (toMinutes(a.inicioPrevisto) || Number.POSITIVE_INFINITY) - (toMinutes(b.inicioPrevisto) || Number.POSITIVE_INFINITY));</div><div><br></div><div>&nbsp; for (let i = sortedData.length - 1; i &gt;= 0; i--) {</div><div>&nbsp; &nbsp; &nbsp; if (sortedData[i].inicioReal) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastCompletedOrStartedEvent = sortedData[i];</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; }</div><div>&nbsp; }</div><div><br></div><div>&nbsp; sortedData.forEach(it =&gt; {</div><div>&nbsp; &nbsp; const plannedStartM = toMinutes(it.inicioPrevisto);</div><div>&nbsp; &nbsp; const plannedEndM = toMinutes(it.fimPrevisto);</div><div>&nbsp; &nbsp; if (plannedStartM !== null &amp;&amp; plannedEndM !== null) {</div><div>&nbsp; &nbsp; &nbsp; const plannedDuration = plannedEndM - plannedStartM;</div><div>&nbsp; &nbsp; &nbsp; if (plannedDuration &gt; 0) totalPlannedDuration += plannedDuration;</div><div>&nbsp; &nbsp; }</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; const realStartM = toMinutes(it.inicioReal);</div><div>&nbsp; &nbsp; const realEndM = toMinutes(it.fimReal);</div><div>&nbsp; &nbsp; if (realStartM !== null &amp;&amp; realEndM !== null) {</div><div>&nbsp; &nbsp; &nbsp; const realDuration = realEndM - realStartM;</div><div>&nbsp; &nbsp; &nbsp; if (realDuration &gt; 0) totalRealDuration += realDuration;</div><div>&nbsp; &nbsp; }</div><div>&nbsp; });</div><div><br></div><div>&nbsp; if (lastCompletedOrStartedEvent) {</div><div>&nbsp; &nbsp; &nbsp; if (lastCompletedOrStartedEvent.fimReal) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const plannedEndM = toMinutes(lastCompletedOrStartedEvent.fimPrevisto);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const realEndM = toMinutes(lastCompletedOrStartedEvent.fimReal);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (plannedEndM !== null &amp;&amp; realEndM !== null) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; totalDeviationMinutes = realEndM - plannedEndM;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const plannedStartM = toMinutes(lastCompletedOrStartedEvent.inicioPrevisto);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const realStartM = toMinutes(lastCompletedOrStartedEvent.inicioReal);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (plannedStartM !== null &amp;&amp; realStartM !== null) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; totalDeviationMinutes = realStartM - plannedStartM;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; }</div><div>&nbsp; }</div><div><br></div><div>&nbsp; const statusInfo = getFormattedDeviation(totalDeviationMinutes);</div><div>&nbsp; const lastPlannedItem = sortedData.length &gt; 0 ? sortedData[sortedData.length - 1] : null;</div><div>&nbsp; const plannedEnd = lastPlannedItem ? formatTime(lastPlannedItem.fimPrevisto) : null;</div><div>&nbsp; const estimatedEnd = plannedEnd ? new Date(plannedEnd.getTime() + totalDeviationMinutes * 60000) : new Date();</div><div><br></div><div>&nbsp; const statusIcon = totalDeviationMinutes &gt; 5</div><div>&nbsp; &nbsp; ? `&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/&gt;&lt;/svg&gt;`</div><div>&nbsp; &nbsp; : (totalDeviationMinutes &lt; -5</div><div>&nbsp; &nbsp; &nbsp; ? `&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/&gt;&lt;/svg&gt;`</div><div>&nbsp; &nbsp; &nbsp; : `&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M12 11V6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2z"/&gt;&lt;/svg&gt;`);</div><div><br></div><div>&nbsp; container.innerHTML = `</div><div>&lt;div class="bg-gray-50 p-6 rounded-lg shadow-inner mb-6"&gt;</div><div>&nbsp; &lt;div class="flex items-center gap-4 mb-4"&gt;</div><div>&nbsp; &nbsp; ${statusIcon}</div><div>&nbsp; &nbsp; &lt;div&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;h2 class="text-2xl font-bold"&gt;Status do Dia: &lt;span class="${statusInfo.colorClass}"&gt;${statusInfo.text}&lt;/span&gt;&lt;/h2&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-sm font-semibold text-gray-600"&gt;Variação Acumulada: ${statusInfo.text}&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center"&gt;</div><div>&nbsp; &nbsp; &lt;div class="p-4 bg-white rounded-lg shadow"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-lg text-gray-600"&gt;Duração Prevista&lt;/p&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-2xl font-bold text-indigo-700"&gt;${formatRealDuration(totalPlannedDuration)}&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="p-4 bg-white rounded-lg shadow"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-lg text-gray-600"&gt;Duração Real (Concluídas)&lt;/p&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-2xl font-bold text-indigo-700"&gt;${formatRealDuration(totalRealDuration)}&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &nbsp; &lt;div class="p-4 bg-white rounded-lg shadow"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-lg text-gray-600"&gt;Fim Estimado&lt;/p&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;p class="text-2xl font-bold text-indigo-700"&gt;${estimatedEnd.getHours().toString().padStart(2, '0')}:${estimatedEnd.getMinutes().toString().padStart(2, '0')}&lt;/p&gt;</div><div>&nbsp; &nbsp; &lt;/div&gt;</div><div>&nbsp; &lt;/div&gt;</div><div>&lt;/div&gt;`;</div><div>};</div><div><br></div><div>window.formatInputTime = (input) =&gt; {</div><div>&nbsp; &nbsp; const originalValue = input.value;</div><div>&nbsp; &nbsp; let digits = originalValue.replace(/\D/g, '');</div><div>&nbsp; &nbsp; let formattedValue = originalValue;</div><div><br></div><div>&nbsp; &nbsp; if (digits.length &gt; 4) digits = digits.slice(0, 4);</div><div>&nbsp; &nbsp; if (digits.length === 3) formattedValue = digits[0] + ':' + digits.slice(1);</div><div>&nbsp; &nbsp; else if (digits.length === 4) formattedValue = digits.slice(0, 2) + ':' + digits.slice(2);</div><div>&nbsp; &nbsp; else formattedValue = digits;</div><div><br></div><div>&nbsp; &nbsp; if (originalValue !== formattedValue) input.value = formattedValue;</div><div>};</div><div><br></div><div>/* ===================== EXPORT/IMPORT AND CSV ===================== */</div><div>function validarDadosParaBackup(dados) {</div><div>&nbsp; if (typeof dados !== 'object' || dados === null) return { valido: false, mensagem: "Estrutura do arquivo de backup é inválida." };</div><div>&nbsp; if (!Array.isArray(dados.allActivities)) return { valido: false, mensagem: "O campo 'allActivities' não é um array válido." };</div><div>&nbsp; for (const item of dados.allActivities) {</div><div>&nbsp; &nbsp; if (typeof item.id !== 'string' || !item.id) return { valido: false, mensagem: "Dados de atividade corrompidos: 'id' ausente ou inválido." };</div><div>&nbsp; &nbsp; if (typeof item.day !== 'string' || (item.day !== 'sabado' &amp;&amp; item.day !== 'domingo')) return { valido: false, mensagem: "Dados de atividade corrompidos: 'day' inválido." };</div><div>&nbsp; }</div><div>&nbsp; return { valido: true, mensagem: "Dados validados com sucesso!" };</div><div>}</div><div>window.exportAllData = () =&gt; {</div><div>&nbsp; const validacao = validarDadosParaBackup(state);</div><div>&nbsp; if (!validacao.valido) { showNotification("Erro na Validação", `O backup não pode ser exportado: ${validacao.mensagem}`); return; }</div><div>&nbsp; const timestamp = new Date().toISOString().slice(0, 19).replace(/T/, '_').replace(/:/g, '-');</div><div>&nbsp; const payload = JSON.stringify(state, null, 2);</div><div>&nbsp; const filename = `backup_cronograma_${timestamp}.json`;</div><div>&nbsp; downloadText(filename, payload, "application/json;charset=utf-8");</div><div>&nbsp; localStorage.setItem(LAST_EXPORT_KEY, new Date().toISOString());</div><div>&nbsp; showToast('Backup exportado com sucesso!');</div><div>};</div><div>window.showImportConfirmation = () =&gt; { document.getElementById('importConfirmationModal').style.display = 'flex'; };</div><div>document.getElementById('confirmImport').onclick = () =&gt; {</div><div>&nbsp; document.getElementById('importConfirmationModal').style.display = 'none';</div><div>&nbsp; window.importAllData(document.getElementById('import-file').files[0]);</div><div>};</div><div>document.getElementById('cancelImport').onclick = () =&gt; {</div><div>&nbsp; document.getElementById('importConfirmationModal').style.display = 'none';</div><div>&nbsp; document.getElementById('import-file').value = '';</div><div>};</div><div>window.importAllData = (file) =&gt; {</div><div>&nbsp; if (!file) return;</div><div>&nbsp; document.getElementById('loading-overlay').classList.remove('hidden');</div><div>&nbsp; const reader = new FileReader();</div><div>&nbsp; reader.onload = () =&gt; {</div><div>&nbsp; &nbsp; try {</div><div>&nbsp; &nbsp; &nbsp; const json = JSON.parse(reader.result);</div><div>&nbsp; &nbsp; &nbsp; const validacao = validarDadosParaBackup(json);</div><div>&nbsp; &nbsp; &nbsp; if (!validacao.valido) throw new Error(validacao.mensagem);</div><div>&nbsp; &nbsp; &nbsp; state = migrateState(json);</div><div>&nbsp; &nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; &nbsp; renderAllTabs();</div><div>&nbsp; &nbsp; &nbsp; const filename = file.name;</div><div>&nbsp; &nbsp; &nbsp; const parts = filename.match(/backup_cronograma_(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2}-\d{2}).*/);</div><div>&nbsp; &nbsp; &nbsp; if (parts &amp;&amp; parts.length &gt;= 3) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const datePart = parts[1].split('-').reverse().join('/');</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const timePart = parts[2].replace(/-/g, ':');</div><div>&nbsp; &nbsp; &nbsp; &nbsp; showToast(`Backup de ${datePart} às ${timePart} importado com sucesso!`);</div><div>&nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; showToast(`Backup importado com sucesso! Arquivo: ${filename}`);</div><div>&nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; } catch (err) {</div><div>&nbsp; &nbsp; &nbsp; showNotification('Erro ao importar', `Arquivo inválido ou corrompido: ${err.message}`);</div><div>&nbsp; &nbsp; } finally {</div><div>&nbsp; &nbsp; &nbsp; document.getElementById('loading-overlay').classList.add('hidden');</div><div>&nbsp; &nbsp; }</div><div>&nbsp; &nbsp; document.getElementById('import-file').value = '';</div><div>&nbsp; };</div><div>&nbsp; reader.readAsText(file);</div><div>};</div><div><br></div><div>window.createCsv = (day) =&gt; {</div><div>&nbsp; const data = state.allActivities.filter(item =&gt; item.day === day);</div><div>&nbsp; const headers = ["Atividade", "Local", "Início Previsto", "Fim Previsto", "Início Real", "Fim Real", "Duração Real", "Variação da Atividade", "Observações"];</div><div>&nbsp; let csv = headers.join(',') + '\n';</div><div>&nbsp; data.forEach(it =&gt; {</div><div>&nbsp; &nbsp; const realDuration = (it.fimReal &amp;&amp; it.inicioReal) ? (toMinutes(it.fimReal) - toMinutes(it.inicioReal)) : null;</div><div>&nbsp; &nbsp; let activityVariation = null;</div><div>&nbsp; &nbsp; if (it.fimReal &amp;&amp; it.fimPrevisto) activityVariation = toMinutes(it.fimReal) - toMinutes(it.fimPrevisto);</div><div>&nbsp; &nbsp; const row = [</div><div>&nbsp; &nbsp; &nbsp; `"${(it.atividade||'').replace(/"/g,'""')}"`,</div><div>&nbsp; &nbsp; &nbsp; `"${(it.local||'').replace(/"/g,'""')}"`,</div><div>&nbsp; &nbsp; &nbsp; it.inicioPrevisto || '', it.fimPrevisto || '',</div><div>&nbsp; &nbsp; &nbsp; it.inicioReal || '', it.fimReal || '',</div><div>&nbsp; &nbsp; &nbsp; realDuration !== null ? formatRealDuration(realDuration) : '',</div><div>&nbsp; &nbsp; &nbsp; activityVariation !== null ? getFormattedDeviation(activityVariation).text : '',</div><div>&nbsp; &nbsp; &nbsp; `"${(it.observacoes||'').replace(/"/g,'""')}"`</div><div>&nbsp; &nbsp; ];</div><div>&nbsp; &nbsp; csv += row.join(',') + '\n';</div><div>&nbsp; });</div><div>&nbsp; return csv;</div><div>};</div><div>window.exportDayToCsv = (day) =&gt; {</div><div>&nbsp; const data = state.allActivities.filter(item =&gt; item.day === day);</div><div>&nbsp; if (!data || data.length === 0) return showNotification("Aviso", `Sem dados para exportar em ${day}.`);</div><div>&nbsp; const csv = window.createCsv(day);</div><div>&nbsp; downloadText(`cronograma_${day}.csv`, csv, "text/csv;charset=utf-8");</div><div>};</div><div>window.exportSummaryToHtml = (day) =&gt; {</div><div>&nbsp; const c = document.createElement('div');</div><div>&nbsp; const data = state.allActivities.filter(item =&gt; item.day === day) || [];</div><div>&nbsp; renderSummary(day, data, c);</div><div>&nbsp; const title = day === 'sabado' ? 'Sábado' : 'Domingo';</div><div>&nbsp; const html = `&lt;!DOCTYPE html&gt;&lt;html lang="pt-BR"&gt;&lt;meta charset="utf-8"&gt;</div><div>&lt;title&gt;Resumo ${title}&lt;/title&gt;&lt;body style="font-family:Arial, sans-serif"&gt;${c.innerHTML}&lt;/body&gt;&lt;/html&gt;`;</div><div>&nbsp; downloadText(`resumo_${day}.html`, html, "text/html;charset=utf-8");</div><div>&nbsp; showNotification("Gerado", `Resumo HTML de ${title} baixado.`);</div><div>};</div><div><br></div><div>/* ===================== AI ANALYSIS ===================== */</div><div>window.analyzeDayWithAI = async (day) =&gt; {</div><div>&nbsp; const btnId = day === 'sabado' ? 'analyzeSabadoBtn' : 'analyzeDomingoBtn';</div><div>&nbsp; const btn = document.getElementById(btnId);</div><div>&nbsp; const btnText = btn.querySelector('.btn-text');</div><div>&nbsp; const spinner = btn.querySelector('.spinner');</div><div><br></div><div>&nbsp; // Start loading</div><div>&nbsp; btn.disabled = true;</div><div>&nbsp; btnText.classList.add('hidden');</div><div>&nbsp; spinner.classList.remove('hidden');</div><div><br></div><div>&nbsp; try {</div><div>&nbsp; &nbsp; const data = state.allActivities.filter(item =&gt; item.day === day &amp;&amp; (item.inicioReal || item.fimReal));</div><div>&nbsp; &nbsp; if (data.length === 0) {</div><div>&nbsp; &nbsp; &nbsp; showNotification("Sem dados", "Não há dados de atividades realizadas para analisar neste dia.");</div><div>&nbsp; &nbsp; &nbsp; return;</div><div>&nbsp; &nbsp; }</div><div><br></div><div>&nbsp; &nbsp; const formattedData = data</div><div>&nbsp; &nbsp; &nbsp; .sort((a,b) =&gt; (toMinutes(a.inicioPrevisto) || Number.POSITIVE_INFINITY) - (toMinutes(b.inicioPrevisto) || Number.POSITIVE_INFINITY))</div><div>&nbsp; &nbsp; &nbsp; .map(it =&gt; `- Atividade: ${it.atividade}, Previsto: ${it.inicioPrevisto || '--:--'}-${it.fimPrevisto || '--:--'}, Realizado: ${it.inicioReal || '--:--'}-${it.fimReal || '--:--'}`)</div><div>&nbsp; &nbsp; &nbsp; .join('\n');</div><div><br></div><div>&nbsp; &nbsp; const systemPrompt = "Você é um coordenador de eventos experiente e analítico. Sua tarefa é analisar os dados de um cronograma e fornecer um relatório conciso e útil para a equipe de organização em português do Brasil. Use um tom colaborativo e focado em soluções. Formate sua resposta usando markdown simples (títulos com ###, listas com -).";</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; const userQuery = `</div><div>Com base nos seguintes dados de cronograma do evento, por favor, gere uma análise de desempenho.</div><div><br></div><div>**Dados do Cronograma (${day.charAt(0).toUpperCase() + day.slice(1)}):**</div><div>${formattedData}</div><div><br></div><div>Por favor, estruture sua análise da seguinte forma, com títulos claros:</div><div><br></div><div>### Pontos Positivos:</div><div>(Liste os acertos, como atividades que começaram no horário ou adiantadas, e o impacto positivo disso.)</div><div><br></div><div>### Pontos de Melhoria:</div><div>(Liste os desvios, atrasos e falhas. Explique o possível impacto cascata desses atrasos e seja específico sobre quais atividades foram mais afetadas.)</div><div><br></div><div>### Recomendações:</div><div>(Ofereça sugestões práticas e acionáveis para evitar problemas semelhantes no futuro. Por exemplo, alocar mais tempo para transições, verificar a prontidão da próxima atividade com antecedência, etc.)</div><div><br></div><div>### Resumo Geral:</div><div>(Faça uma breve conclusão sobre o andamento do dia.)</div><div>`;</div><div><br></div><div>&nbsp; &nbsp; const apiKey = "";&nbsp;</div><div>&nbsp; &nbsp; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;</div><div>&nbsp; &nbsp; const payload = {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; contents: [{ parts: [{ text: userQuery }] }],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; systemInstruction: {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; parts: [{ text: systemPrompt }]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; },</div><div>&nbsp; &nbsp; };</div><div><br></div><div>&nbsp; &nbsp; const response = await fetch(apiUrl, {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; method: 'POST',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; headers: { 'Content-Type': 'application/json' },</div><div>&nbsp; &nbsp; &nbsp; &nbsp; body: JSON.stringify(payload)</div><div>&nbsp; &nbsp; });</div><div><br></div><div>&nbsp; &nbsp; if (!response.ok) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const error = await response.json();</div><div>&nbsp; &nbsp; &nbsp; &nbsp; throw new Error(error.error?.message || `API Error: ${response.status}`);</div><div>&nbsp; &nbsp; }</div><div><br></div><div>&nbsp; &nbsp; const result = await response.json();</div><div>&nbsp; &nbsp; const candidate = result.candidates?.[0];</div><div><br></div><div>&nbsp; &nbsp; if (candidate &amp;&amp; candidate.content?.parts?.[0]?.text) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const analysisText = candidate.content.parts[0].text;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const lines = analysisText.split('\n');</div><div>&nbsp; &nbsp; &nbsp; &nbsp; let htmlResult = '';</div><div>&nbsp; &nbsp; &nbsp; &nbsp; let inList = false;</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; lines.forEach(line =&gt; {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const trimmedLine = line.trim();</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (trimmedLine.startsWith('### ')) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (inList) { htmlResult += '&lt;/ul&gt;'; inList = false; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; htmlResult += `&lt;h3 class="text-lg font-bold mt-4 mb-2"&gt;${trimmedLine.substring(4)}&lt;/h3&gt;`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (trimmedLine.startsWith('- ')) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!inList) { htmlResult += '&lt;ul class="list-disc pl-5 mt-2"&gt;'; inList = true; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; htmlResult += `&lt;li class="mb-1"&gt;${trimmedLine.substring(2).replace(/\*\*(.*?)\*\*/g, '&lt;strong&gt;$1&lt;/strong&gt;')}&lt;/li&gt;`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (trimmedLine) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (inList) { htmlResult += '&lt;/ul&gt;'; inList = false; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; htmlResult += `&lt;p&gt;${trimmedLine.replace(/\*\*(.*?)\*\*/g, '&lt;strong&gt;$1&lt;/strong&gt;')}&lt;/p&gt;`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; &nbsp; &nbsp; if (inList) { htmlResult += '&lt;/ul&gt;'; }</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('aiAnalysisResult').innerHTML = htmlResult;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('aiAnalysisModal').style.display = 'flex';</div><div>&nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; throw new Error("A resposta da IA está vazia ou em formato inválido.");</div><div>&nbsp; &nbsp; }</div><div><br></div><div>&nbsp; } catch (error) {</div><div>&nbsp; &nbsp; console.error("Erro na análise com IA:", error);</div><div>&nbsp; &nbsp; showNotification("Erro de Análise", `Não foi possível obter a análise da IA: ${error.message}`);</div><div>&nbsp; } finally {</div><div>&nbsp; &nbsp; // End loading</div><div>&nbsp; &nbsp; btn.disabled = false;</div><div>&nbsp; &nbsp; btnText.classList.remove('hidden');</div><div>&nbsp; &nbsp; spinner.classList.add('hidden');</div><div>&nbsp; }</div><div>};</div><div><br></div><div><br></div><div>/* ===================== CATALOG CRUD ===================== */</div><div>window.addActivity = () =&gt; {</div><div>&nbsp; const input = document.getElementById('new-activity-input');</div><div>&nbsp; const name = (input.value || '').trim();</div><div>&nbsp; if (!name || (state.activities||[]).includes(name)) return;</div><div>&nbsp; state.activities.push(name);</div><div>&nbsp; state.activities.sort();</div><div>&nbsp; saveState();</div><div>&nbsp; input.value = '';</div><div>&nbsp; renderAllTabs();</div><div>};</div><div>window.removeActivity = (activity) =&gt; {</div><div>&nbsp; state.activities = (state.activities||[]).filter(t =&gt; t !== activity);</div><div>&nbsp; saveState();</div><div>&nbsp; renderAllTabs();</div><div>};</div><div>window.addLocation = () =&gt; {</div><div>&nbsp; const input = document.getElementById('new-location-input');</div><div>&nbsp; const name = (input.value || '').trim();</div><div>&nbsp; if (!name || (state.locations||[]).includes(name)) return;</div><div>&nbsp; state.locations.push(name);</div><div>&nbsp; state.locations.sort();</div><div>&nbsp; saveState();</div><div>&nbsp; input.value = '';</div><div>&nbsp; renderAllTabs();</div><div>};</div><div>window.removeLocation = (location) =&gt; {</div><div>&nbsp; state.locations = (state.locations||[]).filter(t =&gt; t !== location);</div><div>&nbsp; saveState();</div><div>&nbsp; renderAllTabs();</div><div>};</div><div><br></div><div><br></div><div>/* ===================== ACTIVITY ADD/DELETE ===================== */</div><div>window.addNewActivity = (day, prevId, insertAbove) =&gt; {</div><div>&nbsp; const newItem = {</div><div>&nbsp; &nbsp; id: crypto.randomUUID(), day, atividade: "Nova Atividade", local: "",</div><div>&nbsp; &nbsp; inicioPrevisto: "", fimPrevisto: "", inicioReal: "", fimReal: "",</div><div>&nbsp; &nbsp; observacoes: ""</div><div>&nbsp; };</div><div>&nbsp; const currentActivities = [...state.allActivities];</div><div>&nbsp; const prevIndex = currentActivities.findIndex(item =&gt; item.id === prevId);</div><div>&nbsp; let newIndex;</div><div>&nbsp; if (prevIndex &gt; -1) newIndex = insertAbove ? prevIndex : prevIndex + 1;</div><div>&nbsp; else {</div><div>&nbsp; &nbsp; const dayActivities = currentActivities.filter(item =&gt; item.day === day);</div><div>&nbsp; &nbsp; const sortedDayActivities = dayActivities.sort((a,b) =&gt; (toMinutes(a.inicioPrevisto) || Number.POSITIVE_INFINITY) - (toMinutes(b.inicioPrevisto) || Number.POSITIVE_INFINITY));</div><div>&nbsp; &nbsp; if (sortedDayActivities.length === 0) newIndex = currentActivities.length;</div><div>&nbsp; &nbsp; else {</div><div>&nbsp; &nbsp; &nbsp; const lastItem = sortedDayActivities[sortedDayActivities.length - 1];</div><div>&nbsp; &nbsp; &nbsp; newIndex = currentActivities.findIndex(item =&gt; item.id === lastItem.id) + 1;</div><div>&nbsp; &nbsp; }</div><div>&nbsp; }</div><div>&nbsp; state.allActivities.splice(newIndex, 0, newItem);</div><div>&nbsp; saveState();</div><div>&nbsp; document.getElementById('addModal').style.display = 'none';</div><div>&nbsp; renderAllTabs();</div><div>};</div><div><br></div><div>window.showDeleteModal = (id) =&gt; { itemToDelete = { id }; document.getElementById('deleteModal').style.display = 'flex'; };</div><div>document.getElementById('cancelDelete').onclick = () =&gt; { document.getElementById('deleteModal').style.display = 'none'; };</div><div>document.getElementById('confirmDelete').onclick = () =&gt; {</div><div>&nbsp; const { id } = itemToDelete;</div><div>&nbsp; document.getElementById('deleteModal').style.display = 'none';</div><div>&nbsp; if (id) {</div><div>&nbsp; &nbsp; state.allActivities = state.allActivities.filter(item =&gt; item.id !== id);</div><div>&nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; renderAllTabs();</div><div>&nbsp; &nbsp; showToast('Atividade removida com sucesso!');</div><div>&nbsp; }</div><div>};</div><div>window.showAddModal = (id, day) =&gt; {</div><div>&nbsp; itemToAdd = { day, prevId: id };</div><div>&nbsp; if (!id) {</div><div>&nbsp; &nbsp; &nbsp; window.addNewActivity(day, null, false);</div><div>&nbsp; &nbsp; &nbsp; return;</div><div>&nbsp; }</div><div>&nbsp; document.getElementById('addModal').style.display = 'flex';</div><div>};</div><div>document.getElementById('cancelAdd').onclick = () =&gt; { document.getElementById('addModal').style.display = 'none'; };</div><div>document.getElementById('addAbove').onclick = () =&gt; {</div><div>&nbsp; window.addNewActivity(itemToAdd.day, itemToAdd.prevId, true);</div><div>&nbsp; document.getElementById('addModal').style.display = 'none';</div><div>};</div><div>document.getElementById('addBelow').onclick = () =&gt; {</div><div>&nbsp; window.addNewActivity(itemToAdd.day, itemToAdd.prevId, false);</div><div>&nbsp; document.getElementById('addModal').style.display = 'none';</div><div>};</div><div><br></div><div>/* ===================== ALERT MANAGEMENT ===================== */</div><div>window.addGlobalAlert = () =&gt; {</div><div>&nbsp; &nbsp; if (!state.globalAlerts) state.globalAlerts = [];</div><div>&nbsp; &nbsp; state.globalAlerts.unshift(ensureGlobalAlertShape({</div><div>&nbsp; &nbsp; &nbsp; &nbsp; event: '',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; day: 'sabado'</div><div>&nbsp; &nbsp; }));</div><div>&nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; renderAlertsManager();</div><div>&nbsp; &nbsp; showToast('Nova linha de alerta adicionada.');</div><div>};</div><div><br></div><div>window.saveGlobalAlertChange = (alertId, field, value) =&gt; {</div><div>&nbsp; &nbsp; const alertIndex = (state.globalAlerts || []).findIndex(a =&gt; a.id === alertId);</div><div>&nbsp; &nbsp; if (alertIndex === -1) return;</div><div><br></div><div>&nbsp; &nbsp; const alert = state.globalAlerts[alertIndex];</div><div><br></div><div>&nbsp; &nbsp; if (field === 'alertTime') {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alert.alertTime = sanitizeHHMM(value);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alert.firedTime = null;</div><div>&nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alert[field] = value;</div><div>&nbsp; &nbsp; }</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; if (field === 'day' || field === 'event') {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; const correspondingActivity = state.allActivities.find(act =&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; act.atividade === alert.event &amp;&amp; act.day === alert.day</div><div>&nbsp; &nbsp; &nbsp; &nbsp; );</div><div>&nbsp; &nbsp; &nbsp; &nbsp; alert.plannedStartTime = correspondingActivity ? correspondingActivity.inicioPrevisto : '';</div><div>&nbsp; &nbsp; }</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; renderAlertsManager();</div><div>&nbsp; &nbsp; showToast('Alerta atualizado!');</div><div>};</div><div><br></div><div>window.removeGlobalAlert = (alertId) =&gt; {</div><div>&nbsp; &nbsp; state.globalAlerts = (state.globalAlerts || []).filter(a =&gt; a.id !== alertId);</div><div>&nbsp; &nbsp; saveState();</div><div>&nbsp; &nbsp; renderAlertsManager();</div><div>&nbsp; &nbsp; showToast('Alerta removido.');</div><div>};</div><div><br></div><div><br></div><div>/* ===================== TABLE RENDERING (Complete Schedule) ===================== */</div><div>window.filterAndRender = () =&gt; {</div><div>&nbsp; const container = document.getElementById('programacao-completa-container');</div><div>&nbsp; const searchTerm = (document.getElementById('searchInput')?.value || '').toLowerCase();</div><div>&nbsp; const dayFilter = document.getElementById('dayFilter')?.value || 'all';</div><div><br></div><div>&nbsp; let filteredActivities = [...state.allActivities];</div><div>&nbsp; if (dayFilter !== 'all') filteredActivities = filteredActivities.filter(item =&gt; item.day === dayFilter);</div><div>&nbsp; if (searchTerm) {</div><div>&nbsp; &nbsp; filteredActivities = filteredActivities.filter(item =&gt;&nbsp;</div><div>&nbsp; &nbsp; &nbsp; (item.atividade &amp;&amp; item.atividade.toLowerCase().includes(searchTerm)) ||</div><div>&nbsp; &nbsp; &nbsp; (item.local &amp;&amp; item.local.toLowerCase().includes(searchTerm)) ||</div><div>&nbsp; &nbsp; &nbsp; (item.observacoes &amp;&amp; item.observacoes.toLowerCase().includes(searchTerm))</div><div>&nbsp; &nbsp; );</div><div>&nbsp; }</div><div>&nbsp; filteredActivities.sort((a, b) =&gt; {</div><div>&nbsp; &nbsp; if (a.day !== b.day) return a.day === 'sabado' ? -1 : 1;</div><div>&nbsp; &nbsp; const aTime = toMinutes(a.inicioPrevisto);</div><div>&nbsp; &nbsp; const bTime = toMinutes(b.inicioPrevisto);</div><div>&nbsp; &nbsp; return (aTime === null ? Infinity : aTime) - (bTime === null ? Infinity : bTime);</div><div>&nbsp; });</div><div><br></div><div>&nbsp; const dayCounters = { sabado: 0, domingo: 0 };</div><div>&nbsp; const sortedActivities = [...(state.activities || [])].sort();</div><div>&nbsp; const sortedLocations = [...(state.locations || [])].sort();</div><div><br></div><div>&nbsp; let tableHtml = `&lt;table class="min-w-full bg-white rounded-lg shadow-md"&gt;</div><div>&lt;thead class="bg-gray-200 table-sticky-header"&gt;</div><div>&lt;tr&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Nº&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Ações&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Dia&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Atividade&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Local&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Início Prev.&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left"&gt;Fim Prev.&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left hidden sm:table-cell"&gt;Início Real&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left hidden sm:table-cell"&gt;Fim Real&lt;/th&gt;</div><div>&nbsp; &lt;th class="py-3 px-4 text-left hidden lg:table-cell"&gt;Observações&lt;/th&gt;</div><div>&lt;/tr&gt;</div><div>&lt;/thead&gt;</div><div>&lt;tbody class="text-gray-700"&gt;`;</div><div><br></div><div>&nbsp; filteredActivities.forEach(item =&gt; {</div><div>&nbsp; &nbsp; const displayIndex = ++dayCounters[item.day];</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; const activityOptions = sortedActivities.map(act =&gt; `&lt;option value="${escapeHtml(act)}" ${item.atividade===act?'selected':''}&gt;${escapeHtml(act)}&lt;/option&gt;`).join('');</div><div>&nbsp; &nbsp; const locationOptions = sortedLocations.map(l =&gt; `&lt;option value="${escapeHtml(l)}" ${item.local===l?'selected':''}&gt;${escapeHtml(l)}&lt;/option&gt;`).join('');</div><div><br></div><div>&nbsp; &nbsp; tableHtml += `&lt;tr class="border-b border-gray-200 hover:bg-gray-50" data-id="${item.id}"&gt;</div><div>&lt;td class="py-3 px-4 font-semibold"&gt;${displayIndex}&lt;/td&gt;</div><div>&lt;td class="py-3 px-4 flex items-center gap-2"&gt;</div><div>&nbsp; &lt;button class="btn btn-danger btn-icon" title="Remover atividade" onclick="window.showDeleteModal('${item.id}')"&gt;🗑️&lt;/button&gt;</div><div>&nbsp; &lt;button class="btn btn-success btn-icon" title="Adicionar atividade" onclick="window.showAddModal('${item.id}', '${item.day}')"&gt;➕&lt;/button&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4 font-semibold whitespace-nowrap"&gt;</div><div>&nbsp; &lt;select class="w-full bg-transparent focus:outline-none js-day-select" onchange="window.saveChanges('${item.id}', {day: this.value})"&gt;</div><div>&nbsp; &nbsp; &lt;option value="sabado" ${item.day==='sabado'?'selected':''}&gt;Sábado&lt;/option&gt;</div><div>&nbsp; &nbsp; &lt;option value="domingo" ${item.day==='domingo'?'selected':''}&gt;Domingo&lt;/option&gt;</div><div>&nbsp; &lt;/select&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4"&gt;</div><div>&nbsp; &lt;select class="w-full bg-transparent focus:outline-none js-activity-select" onchange="window.saveChanges('${item.id}', {atividade: this.value})"&gt;</div><div>&nbsp; &nbsp; &lt;option value=""&gt;Nenhuma&lt;/option&gt;</div><div>&nbsp; &nbsp; ${activityOptions}</div><div>&nbsp; &lt;/select&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4"&gt;</div><div>&nbsp; &lt;select class="w-full bg-transparent focus:outline-none js-location-select" onchange="window.saveChanges('${item.id}', {local: this.value})"&gt;</div><div>&nbsp; &nbsp; &lt;option value=""&gt;Nenhum&lt;/option&gt;${locationOptions}</div><div>&nbsp; &lt;/select&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4"&gt;</div><div>&nbsp; &lt;input type="text" inputmode="numeric" maxlength="5" pattern="\\d{1,2}:\\d{2}" placeholder="HH:mm" class="planned-time-input bg-transparent" value="${item.inicioPrevisto || ''}" onblur="window.saveChanges('${item.id}', {inicioPrevisto: this.value})"&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4"&gt;</div><div>&nbsp; &lt;input type="text" inputmode="numeric" maxlength="5" pattern="\\d{1,2}:\\d{2}" placeholder="HH:mm" class="planned-time-input bg-transparent" value="${item.fimPrevisto || ''}" onblur="window.saveChanges('${item.id}', {fimPrevisto: this.value})"&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4 hidden sm:table-cell"&gt;</div><div>&nbsp; &lt;input type="text" inputmode="numeric" placeholder="HH:mm" class="planned-time-input bg-transparent" value="${item.inicioReal || ''}" onblur="window.saveChanges('${item.id}', {inicioReal: this.value})"&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4 hidden sm:table-cell"&gt;</div><div>&nbsp; &lt;input type="text" inputmode="numeric" placeholder="HH:mm" class="planned-time-input bg-transparent" value="${item.fimReal || ''}" onblur="window.saveChanges('${item.id}', {fimReal: this.value})"&gt;</div><div>&lt;/td&gt;</div><div>&lt;td class="py-3 px-4 hidden lg:table-cell"&gt;</div><div>&nbsp; &lt;input type="text" class="w-full bg-transparent focus:outline-none" placeholder="Observações..." value="${escapeHtml(item.observacoes || '')}" onblur="window.saveChanges('${item.id}', {observacoes: this.value})"&gt;</div><div>&lt;/td&gt;</div><div>&lt;/tr&gt;`;</div><div>&nbsp; });</div><div>&nbsp; tableHtml += `&lt;/tbody&gt;&lt;/table&gt;`;</div><div>&nbsp; container.innerHTML = tableHtml;</div><div>};</div><div><br></div><div>window.renderProgramacaoCompleta = window.filterAndRender;</div><div><br></div><div>const renderActivitiesManager = () =&gt; {</div><div>&nbsp; const el = document.getElementById('activities-list');</div><div>&nbsp; const activities = [...(state.activities || [])].sort();</div><div>&nbsp; el.innerHTML = activities.map(activity =&gt; `</div><div>&lt;div class="flex items-center justify-between bg-white py-1 pl-3 pr-2 rounded-full shadow-sm text-sm border border-gray-200"&gt;</div><div>&nbsp; &lt;span class="font-medium mr-2"&gt;${escapeHtml(activity)}&lt;/span&gt;</div><div>&nbsp; &lt;button onclick="window.removeActivity('${escapeHtml(activity)}')" class="text-red-500 hover:text-red-700 focus:outline-none rounded-full h-5 w-5 flex items-center justify-center hover:bg-red-100 transition-colors"&gt;&amp;times;&lt;/button&gt;</div><div>&lt;/div&gt;`).join('');</div><div>};</div><div>const renderLocationsManager = () =&gt; {</div><div>&nbsp; const el = document.getElementById('locations-list');</div><div>&nbsp; const locations = [...(state.locations || [])].sort();</div><div>&nbsp; el.innerHTML = locations.map(loc =&gt; `</div><div>&lt;div class="flex items-center justify-between bg-white py-1 pl-3 pr-2 rounded-full shadow-sm text-sm border border-gray-200"&gt;</div><div>&nbsp; &lt;span class="font-medium mr-2"&gt;${escapeHtml(loc)}&lt;/span&gt;</div><div>&nbsp; &lt;button onclick="window.removeLocation('${escapeHtml(loc)}')" class="text-red-500 hover:text-red-700 focus:outline-none rounded-full h-5 w-5 flex items-center justify-center hover:bg-red-100 transition-colors"&gt;&amp;times;&lt;/button&gt;</div><div>&lt;/div&gt;`).join('');</div><div>};</div><div><br></div><div>const renderAlertsManager = () =&gt; {</div><div>&nbsp; &nbsp; const container = document.getElementById('alert-manager-container');</div><div>&nbsp; &nbsp; const searchTerm = (document.getElementById('alertSearchInput')?.value || '').toLowerCase();</div><div><br></div><div>&nbsp; &nbsp; let filteredAlerts = [...(state.globalAlerts || [])];</div><div>&nbsp; &nbsp; if (searchTerm) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; filteredAlerts = filteredAlerts.filter(alert =&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (alert.event &amp;&amp; alert.event.toLowerCase().includes(searchTerm)) ||</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (alert.message &amp;&amp; alert.message.toLowerCase().includes(searchTerm))</div><div>&nbsp; &nbsp; &nbsp; &nbsp; );</div><div>&nbsp; &nbsp; }</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; const sortedActivities = [...(state.activities || [])].sort();</div><div><br></div><div>&nbsp; &nbsp; let tableHtml = `&lt;table class="min-w-full bg-white rounded-lg shadow-md"&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;thead class="bg-gray-200 table-sticky-header"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;tr&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 text-left w-32"&gt;Dia&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 text-left"&gt;Atividade&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 text-left w-40"&gt;Hora Início Previsto&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 text-left w-32"&gt;Hora do Alerta&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 text-left"&gt;Mensagem&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th class="py-3 px-4 text-left w-20"&gt;Ações&lt;/th&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;/thead&gt;</div><div>&nbsp; &nbsp; &nbsp; &lt;tbody class="text-gray-700"&gt;`;</div><div><br></div><div>&nbsp; &nbsp; if (filteredAlerts.length === 0) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; tableHtml += `&lt;tr&gt;&lt;td colspan="6" class="text-center py-4 text-gray-500"&gt;Nenhum alerta encontrado.&lt;/td&gt;&lt;/tr&gt;`;</div><div>&nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; filteredAlerts.forEach(alert =&gt; {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const hasFired = !!alert.firedTime;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const firedClass = hasFired ? 'bg-green-50' : '';</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const activityOptions = sortedActivities.map(act =&gt; `&lt;option value="${escapeHtml(act)}" ${alert.event === act ? 'selected' : ''}&gt;${escapeHtml(act)}&lt;/option&gt;`).join('');</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tableHtml += `</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tr class="border-b border-gray-200 hover:bg-gray-50 ${firedClass}" data-id="${alert.id}"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select class="w-full p-1 border border-gray-300 rounded-md" onchange="window.saveGlobalAlertChange('${alert.id}', 'day', this.value)"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="sabado" ${alert.day === 'sabado' ? 'selected' : ''}&gt;Sábado&lt;/option&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="domingo" ${alert.day === 'domingo' ? 'selected' : ''}&gt;Domingo&lt;/option&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select class="w-full p-1 border border-gray-300 rounded-md" onchange="window.saveGlobalAlertChange('${alert.id}', 'event', this.value)"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=""&gt;Selecione...&lt;/option&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ${activityOptions}</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" class="planned-time-input w-full p-1" value="${alert.plannedStartTime || ''}" onblur="window.saveGlobalAlertChange('${alert.id}', 'plannedStartTime', this.value)" oninput="window.formatInputTime(this)" placeholder="HH:mm"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" class="planned-time-input w-full p-1" value="${alert.alertTime}" onblur="window.saveGlobalAlertChange('${alert.id}', 'alertTime', this.value)" oninput="window.formatInputTime(this)" placeholder="HH:mm"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" class="w-full p-1 border border-gray-300 rounded-md" value="${escapeHtml(alert.message)}" onblur="window.saveGlobalAlertChange('${alert.id}', 'message', this.value)"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-2"&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-danger btn-icon" title="Excluir Alerta" onclick="window.removeGlobalAlert('${alert.id}')"&gt;🗑️&lt;/button&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;`;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; }</div><div><br></div><div>&nbsp; &nbsp; tableHtml += `&lt;/tbody&gt;&lt;/table&gt;`;</div><div>&nbsp; &nbsp; container.innerHTML = tableHtml;</div><div>};</div><div><br></div><div><br></div><div>const renderAlertHistory = () =&gt; {</div><div>&nbsp; const tableBody = document.getElementById('alertHistoryTableBody');</div><div>&nbsp; if (!tableBody) return;</div><div>&nbsp; const sortedHistory = [...state.alertHistory].sort((a, b) =&gt; b.timestamp.localeCompare(a.timestamp));</div><div>&nbsp; tableBody.innerHTML = (sortedHistory.length === 0)</div><div>&nbsp; &nbsp; ? `&lt;tr&gt;&lt;td colspan="4" class="text-center text-gray-500 py-4"&gt;Nenhum evento registrado.&lt;/td&gt;&lt;/tr&gt;`</div><div>&nbsp; &nbsp; : sortedHistory.map(log =&gt; {</div><div>&nbsp; &nbsp; &nbsp; const firedTime = new Date(log.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });</div><div>&nbsp; &nbsp; &nbsp; return `</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;tr&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-4 whitespace-nowrap text-sm font-semibold"&gt;${firedTime}&lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-4 whitespace-nowrap text-sm"&gt;${escapeHtml(log.activity)}&lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-4 whitespace-nowrap text-sm"&gt;${log.alertTime || 'N/A'}&lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class="py-2 px-4 text-sm"&gt;${escapeHtml(log.message) || 'N/A'}&lt;/td&gt;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;`</div><div>&nbsp; &nbsp; }).join('');</div><div>};</div><div><br></div><div>const renderAllTabs = () =&gt; {</div><div>&nbsp; if (isInputFocused) return;</div><div>&nbsp; renderCronograma('sabado');</div><div>&nbsp; renderCronograma('domingo');</div><div>&nbsp; updateHeaderStatus();</div><div>&nbsp; renderActivitiesManager();</div><div>&nbsp; renderLocationsManager();</div><div>&nbsp; renderAlertsManager();</div><div>&nbsp; renderAlertHistory();</div><div>&nbsp; renderProgramacaoCompleta();</div><div><br></div><div>&nbsp; if (document.getElementById('resumoSabado').classList.contains('active'))</div><div>&nbsp; &nbsp; renderSummary('sabado', state.allActivities.filter(item =&gt; item.day === 'sabado'));</div><div>&nbsp; if (document.getElementById('resumoDomingo').classList.contains('active'))</div><div>&nbsp; &nbsp; renderSummary('domingo', state.allActivities.filter(item =&gt; item.day === 'domingo'));</div><div>};</div><div><br></div><div>/* ===================== INITIALIZATION ===================== */</div><div>window.onload = () =&gt; {</div><div>&nbsp; renderAllTabs();</div><div>&nbsp; updateClock();</div><div>&nbsp; setInterval(updateClock, 1000);</div><div>&nbsp; setInterval(checkAndFireAlerts, 30000);</div><div>&nbsp; setInterval(checkExportReminder, 15 * 60 * 1000);</div><div>&nbsp; updateLastUpdatedTime();</div><div>};</div><div>&lt;/script&gt;</div><div>&lt;/body&gt;</div><div>&lt;/html&gt;</div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div></div></body></html>